-- üì¶ –°–û–ó–î–ê–ù–ò–ï –¢–ê–ë–õ–ò–¶

create table category (
	id serial primary key,
	name varchar(50)
);

create table status (
	id serial primary key,
	name varchar(50)
);

create table role (
	id serial primary key,
	name varchar(50)
);

create table employees (
	id serial primary key,
	login varchar(50),
	password varchar(255),
	idRole int,
	surname varchar(50),
	name varchar(50),
	patronymic varchar(50),
	foreign key (idRole) references role(id)
);

create table numberFond (
	id serial primary key,
	floor int,
	number int,
	idCategory int,
	idStatus int,
	price money,
	foreign key (idCategory) references category(id),
	foreign key (idStatus) references status(id)
);

create table cleaningSchedule (
	id serial primary key,
	dateAndTimeOfCleaning timestamp,
	idEmployee int,
	idNumberFond int,
	foreign key (idEmployee) references employees(id),
	foreign key (idNumberFond) references numberFond(id)
);

create table client (
	id serial primary key,
	surname varchar(50),
	name varchar(50),
	patronymic varchar(50)
);

create table reservation (
	id serial primary key,
	idClient int,
	idNumberFond int,
	dateOfEntry date,
	departureDate date,
	idStatus int,
	foreign key (idClient) references client(id),
	foreign key (idNumberFond) references numberFond(id),
	foreign key (idStatus) references status(id)
);

create table service (
	id serial primary key,
	name varchar(50),
	price money,
	description varchar(50)
);

create table contract(
	id serial primary key,
	idStatus int,
	idEmployee int,
	comment varchar(255),
	idReservation int,
	idService int,
	foreign key (idStatus) references status(id),
	foreign key (idEmployee) references employees(id),
	foreign key (idReservation) references reservation(id),
	foreign key (idService) references service(id)
);

-- üìä –ê–ì–†–ï–ì–ê–¢–ù–´–ï –ó–ê–ü–†–û–°–´ –° –§–û–†–ú–£–õ–ê–ú–ò

-- 1. –ü—Ä–æ—Ü–µ–Ω—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–æ–º–µ—Ä–Ω–æ–≥–æ —Ñ–æ–Ω–¥–∞
-- (–∫–æ–ª-–≤–æ –∑–∞–Ω—è—Ç—ã—Ö –Ω–æ—á–µ–π / –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–æ—á–µ–π * 100)
SELECT 
    ROUND(100.0 * COUNT(*) / (SELECT COUNT(*) FROM rooms), 2) AS occupancy_percent
FROM bookings
WHERE CURRENT_DATE BETWEEN check_in_date AND check_out_date;

-- 2. ADR (—Å—Ä–µ–¥–Ω—è—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –Ω–æ–º–µ—Ä–∞ –∑–∞ –ø–µ—Ä–∏–æ–¥)
SELECT 
    ROUND(SUM(total_amount) / SUM(DATE_PART('day', check_out_date - check_in_date)), 2) AS adr
FROM bookings;

-- 3. RevPAR = ADR * –ü—Ä–æ—Ü–µ–Ω—Ç –∑–∞–≥—Ä—É–∑–∫–∏
WITH 
    stats AS (
        SELECT 
            SUM(total_amount) AS revenue,
            SUM(DATE_PART('day', check_out_date - check_in_date)) AS nights_sold,
            (SELECT COUNT(*) FROM rooms) AS total_rooms
        FROM bookings
    )
SELECT 
    ROUND((revenue / total_rooms), 2) AS revpar
FROM stats;

-- üõ† –í–°–¢–ê–í–ö–ê –î–ê–ù–ù–´–•

INSERT INTO guests (full_name, birth_date, phone, email, passport_number)
VALUES ('–ü–µ—Ç—Ä–æ–≤ –ò–≤–∞–Ω', '1990-01-01', '+7 999 123-45-67', 'ivan@example.com', '1234567890');

INSERT INTO room_types (type_name, price_per_night)
VALUES ('–û–¥–Ω–æ–º–µ—Å—Ç–Ω—ã–π', 2500.00), ('–î–≤—É—Ö–º–µ—Å—Ç–Ω—ã–π', 4000.00);

INSERT INTO rooms (room_number, room_type_id, status)
VALUES ('101', 1, '–°–≤–æ–±–æ–¥–µ–Ω'), ('102', 2, '–ì—Ä—è–∑–Ω—ã–π');

INSERT INTO employees (full_name, role, hire_date)
VALUES ('–°–∏–¥–æ—Ä–æ–≤–∞ –ú–∞—Ä–∏—è', '–£–±–æ—Ä—â–∏—Ü–∞', '2022-06-01');

INSERT INTO bookings (guest_id, room_id, check_in_date, check_out_date, total_amount, payment_status)
VALUES (1, 1, '2025-04-01', '2025-04-05', 10000.00, TRUE);

INSERT INTO cleaning (room_id, employee_id, cleaning_date, status)
VALUES (2, 1, '2025-04-06', '–í—ã–ø–æ–ª–Ω–µ–Ω–∞');

//mobilephone
//var regex = @"^\+[0-9]+\s[0-9]{3}\s[0-9]{3}-[0-9]{2}-[0-9]{2}$";

üß± –≠–ª–µ–º–µ–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è (Controls)
<Button Content="–ù–∞–∂–º–∏ –º–µ–Ω—è" Click="OnClick" Width="100"/>
<TextBox Watermark="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç" Width="200"/>
<CheckBox Content="–°–æ–≥–ª–∞—Å–µ–Ω" IsChecked="True"/>
<ComboBox Items="{Binding –°–ø–∏—Å–æ–∫}" SelectedItem="{Binding –í—ã–±—Ä–∞–Ω–Ω—ã–π–≠–ª–µ–º–µ–Ω—Ç}"/>
<ListBox Items="{Binding –≠–ª–µ–º–µ–Ω—Ç—ã}" SelectedItem="{Binding –í—ã–±—Ä–∞–Ω–Ω—ã–π–≠–ª–µ–º–µ–Ω—Ç}"/>

üìê –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∫–æ–º–ø–æ–Ω–æ–≤–∫–∏ (Layout Containers)
<StackPanel Orientation="Vertical" Spacing="10">
    <!-- –≠–ª–µ–º–µ–Ω—Ç—ã -->
</StackPanel>

<WrapPanel Orientation="Horizontal" ItemSpacing="10">
    <!-- –≠–ª–µ–º–µ–Ω—Ç—ã —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –ø–µ—Ä–µ–Ω–æ—Å–æ–º -->
</WrapPanel>

<Grid>
    <Grid.ColumnDefinitions>
        <ColumnDefinition Width="2*"/>
        <ColumnDefinition Width="1*"/>
    </Grid.ColumnDefinitions>
    <Grid.RowDefinitions>
        <RowDefinition Height="Auto"/>
        <RowDefinition Height="*"/>
    </Grid.RowDefinitions>
    <!-- –≠–ª–µ–º–µ–Ω—Ç—ã —Å —É–∫–∞–∑–∞–Ω–∏–µ–º Grid.Row –∏ Grid.Column -->
</Grid>

üîó –ü—Ä–∏–≤—è–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö (Data Binding)
<TextBlock Text="{Binding –ò–º—è}"/>
<TextBox Text="{Binding –í–≤–æ–¥, Mode=TwoWay}"/>
<CheckBox IsChecked="{Binding –§–ª–∞–≥}"/>

üìê –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è DataGrid —Å —Ä—É—á–Ω—ã–º –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º –∫–æ–ª–æ–Ω–æ–∫
<Application.Styles>
    <FluentTheme />
    <StyleInclude Source="avares://Avalonia.Controls.DataGrid/Themes/Fluent.xaml"/>
</Application.Styles>

<DataGrid Items="{Binding People}"
          AutoGenerateColumns="False"
          IsReadOnly="True"
          CanUserReorderColumns="True"
          CanUserResizeColumns="True"
          CanUserSortColumns="False"
          GridLinesVisibility="All"
          BorderThickness="1"
          BorderBrush="Gray">
  <DataGrid.Columns>
    <DataGridTextColumn Header="–ò–º—è" Binding="{Binding FirstName}" Width="2*"/>
    <DataGridTextColumn Header="–§–∞–º–∏–ª–∏—è" Binding="{Binding LastName}" Width="2*"/>
    <DataGridCheckBoxColumn Header="–ê–∫—Ç–∏–≤–µ–Ω" Binding="{Binding IsActive}" Width="*"/>
  </DataGrid.Columns>
</DataGrid>
